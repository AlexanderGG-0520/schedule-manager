{% extends 'base.html' %}
{% block content %}
<div class="event-form">
  <h2>組織: {{ org.name }}</h2>

  <h3>メンバー</h3>
  <ul class="member-list">
    {% for m in org.members %}
    <li class="member-item">
      <div class="member-meta">{{ m.username }} ({{ m.email }})</div>
      <div>
        {% if m != current_user %}
        <form method="post" action="{{ url_for('organizations.remove_member', org_id=org.id, user_id=m.id) }}" style="display:inline" class="remove-member-form" data-member-id="{{ m.id }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button type="button" class="btn small-btn btn-remove" data-bs-toggle="modal" data-bs-target="#removeConfirmModal" data-member-id="{{ m.id }}">削除</button>
        </form>
        {% else %}
        <span class="help-text">あなた</span>
        {% endif %}
      </div>
    </li>
    {% endfor %}
    {% if not org.members %}
    <li class="member-item">メンバーはまだいません。</li>
    {% endif %}
  </ul>

  <h3>メンバーを招待</h3>
  <form method="post" action="{{ url_for('organizations.invite_member', org_id=org.id) }}" class="invite-form">
    {{ invite_form.hidden_tag() }}
    {{ invite_form.username(class='input') }}
    <button type="submit" class="btn primary">招待</button>
  </form>
</div>
<!-- Removal confirmation: prefer Bootstrap modal if available, otherwise use a lightweight fallback modal -->
<!-- Bootstrap modal (official markup) -->
<div class="modal fade" id="removeConfirmModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">メンバーを削除しますか？</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>この操作は取り消せません。本当に削除しますか？</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn" data-bs-dismiss="modal">キャンセル</button>
        <button id="confirmRemove" type="button" class="btn btn-danger">削除する</button>
      </div>
    </div>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {
  let activeForm = null;
  document.querySelectorAll('.btn-remove').forEach(function(btn) {
    btn.addEventListener('click', function(e) {
      // locate form nearest to this button
      activeForm = btn.closest('form');
      // The modal is shown by data-bs attributes; nothing else to do here
    });
  });

  const confirm = document.getElementById('confirmRemove');
  confirm.addEventListener('click', function() {
    if (activeForm) {
      activeForm.submit();
    }
  });
});
</script>
{% endblock %}
